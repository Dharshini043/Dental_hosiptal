<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_doctor_treatment_pdf">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <style>
                    .doctor-report {
                        font-family: 'Helvetica Neue', Arial, sans-serif;
                        color: #333;
                        line-height: 1.4;
                    }

                    .report-header {
                        text-align: center;
                        margin-bottom: 25px;
                        padding-bottom: 15px;
                        border-bottom: 1px solid #e6e6e6;
                    }

                    .report-title {
                        font-size: 26px;
                        font-weight: bold;
                        margin: 0;
                        color: #333;
                    }

                    .report-filters {
                        margin-bottom: 20px;
                        padding: 10px 15px;
                        background-color: #f9f9f9;
                        border-radius: 3px;
                        border: 1px solid #e6e6e6;
                    }

                    .filter-item {
                        display: inline-block;
                        margin-right: 30px;
                        font-size: 14px;
                    }

                    .filter-label {
                        font-weight: 600;
                        color: #555;
                    }

                    .report-table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 13px;
                        margin-bottom: 20px;
                    }

                    .report-table th {
                        background-color: #f9f9f9;
                        color: #333;
                        font-weight: 600;
                        padding: 12px 10px;
                        text-align: left;
                        border: 1px solid #e6e6e6;
                    }

                    .report-table td {
                        padding: 10px;
                        border: 1px solid #e6e6e6;
                        vertical-align: top;
                    }

                    .report-table tr:nth-child(even) {
                        background-color: #f9f9f9;
                    }

                    .currency-cell {
                        text-align: right;
                    }

                    @media print {
                        .report-table {
                            page-break-inside: avoid;
                        }
                    }
                </style>

                <div class="doctor-report">
                    <!-- Report Header -->
                    <div class="report-header">
                        <h1 class="report-title">Doctor Report</h1>
                    </div>

                    <!-- Report Filters -->
                    <div class="report-filters">
                        <span class="filter-item">
                            <span class="filter-label">Start Date:</span>
                            <t t-esc="docs.env.context.get('report_start_date') or '-'"/>
                        </span>
                        <span class="filter-item">
                            <span class="filter-label">End Date:</span>
                            <t t-esc="docs.env.context.get('report_end_date') or '-'"/>
                        </span>
                    </div>

                    <!-- Group by Doctor -->
                    <t t-foreach="docs.mapped('prescribed_doctor_id')" t-as="doc_doctor">
                        <h3 style="margin-top:20px; margin-bottom:10px; border-bottom:1px solid #ccc; padding-bottom:5px;">
                            Doctor: <t t-esc="doc_doctor.name"/>
                        </h3>

                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Treatment  Date</th>
                                    <th>Patient Name</th>
                                    <th>Treatment</th>
                                    <th>Cost (₹)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="enumerate(docs.filtered(lambda d: d.prescribed_doctor_id == doc_doctor), start=1)" t-as="p">
                                    <td><t t-esc="p[0]"/></td>
                                    <td><t t-esc="p[1].prescription_date"/></td>
                                    <td><t t-esc="p[1].patient_id.name"/></td>
                                    <td><t t-esc="p[1].treatment_id.name"/></td>
                                    <td class="currency-cell"><t t-esc="p[1].cost"/> ₹</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Subtotals per Doctor -->
                        <div style="text-align:right; margin-bottom:25px;">
                            <p><strong>Total Treatments:</strong>
                                <t t-esc="len(docs.filtered(lambda d: d.prescribed_doctor_id == doc_doctor))"/>
                            </p>
                            <p><strong>Total Cost (₹):</strong>
                                <t t-esc="sum(d.cost for d in docs.filtered(lambda d: d.prescribed_doctor_id == doc_doctor))"/>
                            </p>
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>
